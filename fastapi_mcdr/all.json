{
  "meta": {
    "schema_version": 4,
    "id": "fastapi_mcdr",
    "name": "FastAPI MCDR",
    "version": "2.0.0",
    "link": "https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr",
    "authors": [
      "Andy Zhang"
    ],
    "dependencies": {},
    "requirements": [
      "fastapi",
      "uvicorn"
    ],
    "description": {
      "en_us": "Provides HTTP API.",
      "zh_cn": "æä¾› HTTP APIã€‚"
    }
  },
  "plugin": {
    "schema_version": 1,
    "id": "fastapi_mcdr",
    "authors": [
      "Andy Zhang"
    ],
    "repository": "https://github.com/AnzhiZhang/MCDReforgedPlugins",
    "branch": "master",
    "related_path": "src/fastapi_mcdr",
    "labels": [
      "api"
    ],
    "introduction": {
      "en_us": "# FastAPI\n\n[ç®€ä½“ä¸­æ–‡](https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr/readme_cn.md)\n\n> Provides HTTP API\n> \n> Allows plugins to provide a unified interface by mounting [sub-application](https://fastapi.tiangolo.com/advanced/sub-applications/).\n\n## Quick Start\n\nIn general, there are two things you need to do in your plugin:\n\n1. Check FastAPI's status when loading. If it's ready, directly mount the sub-application.\n2. Register a listener for the COLLECT event to  mount the sub-application when it becomes ready.\n\nSpecifically, you need to add the following code:\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/test\")\nasync def test():\n    return \"Hello, world!\"\n\n\ndef on_load(server, prev_module):\n    # mount if fastapi_mcdr is ready\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n    if fastapi_mcdr is not None and fastapi_mcdr.is_ready():\n        mount_app(server)\n\n    # register event listener\n    server.register_event_listener(\n        fastapi_mcdr.COLLECT_EVENT,\n        mount_app\n    )\n\n\ndef on_unload(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # unmount app\n    fastapi_mcdr.unmount(id_)\n\n\ndef mount_app(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # mount app\n    fastapi_mcdr.mount(id_, app)\n```\n\nVisit <http://localhost:8080/docs> to view the API documentation, and visit <http://localhost:8080/plugin_id/docs> to view the sub application documentation for each plugin.\n\n## Technical Details\n\n### Loading\n\nIn theory, providing an HTTP API externally should be an optional feature. That's why checking FastAPI's status and registering an COLLECT event listener are necessary. The following diagram illustrates the process of loading FastAPI and custom plugins:\n\nLoad FastAPI first, then load custom plugins:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Load\n    Note right of FastAPI: FastAPI Dispatch COLLECT Event\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Mount Sub-Application\n\n    Note left of Test: Test Register COLLECT Event\n```\n\nLoad custom plugins first, then load FastAPI:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: No!\n\n    Note left of Test: Test Register COLLECT Event\n\n    Note right of FastAPI: FastAPI Load\n\n    FastAPI ->> Test: Dispatch COLLECT Event\n    Test ->> FastAPI: Mount Sub-Application\n```\n\nWith this design, you can achieve soft plugin dependency without worrying about the order of plugin loading. The following diagram shows the scenario of any plugin being reloaded:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Reload\n\n    FastAPI ->> Test: Dispatch COLLECT Event\n    Test ->> FastAPI: Mount Sub-Application\n\n    Note left of Test: Test Reload\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Mount Sub-Application\n\n    Note left of Test: Test Register COLLECT Event\n```\n\n## Standards\n\n### COLLECT Event\n\nEvent name: `fastapi_mcdr.collect`\n\nAn instance of `PluginEvent` for this event is also exposed as `COLLECT_EVENT`.\n\n### Public Functions\n\n#### is_ready\n\nThe plugin's status if ready to mount. If forcefully mounted, it will raise a `RuntimeError`.\n\n#### mount\n\nArguments:\n\n- `plugin_id`: Plugin ID.\n- `app`: FastAPI App.\n\nThe sub-application will be mounted at the `/<plugin_id>` path, and the documentation can be viewed by visiting `/<plugin_id>/docs`.\n\nSee: [Sub Applications - Mounts](https://fastapi.tiangolo.com/advanced/sub-applications/)\n\n#### unmount\n\nArguments:\n\n- `plugin_id`: Plugin ID.\n\nUnmount the sub-application of the specified plugin.\n",
      "zh_cn": "# FastAPI\n\n[English](https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr/readme.md)\n\n> æä¾› HTTP APIã€‚\n> \n> å…è®¸æ’ä»¶é€šè¿‡æŒ‚è½½ [å­åº”ç”¨](https://fastapi.tiangolo.com/zh/advanced/sub-applications/) çš„æ–¹å¼ï¼Œæä¾›ç»Ÿä¸€çš„æ¥å£ã€‚\n\n## å¿«é€Ÿå¼€å§‹\n\næ€»åœ°æ¥è¯´ï¼Œæ‚¨éœ€è¦åœ¨æ‚¨çš„æ’ä»¶ä¸­åšä¸¤ä»¶äº‹ï¼š\n\n1. åŠ è½½æ—¶æ£€æŸ¥ FastAPI çŠ¶æ€ï¼Œå¦‚å·²å‡†å¤‡å¥½ï¼Œåˆ™ç›´æ¥æŒ‚è½½å­åº”ç”¨ã€‚\n2. æ³¨å†Œ COLLECT äº‹ä»¶çš„ç›‘å¬å™¨ï¼Œä»¥ä¾¿å‡†å¤‡å¥½æ—¶æŒ‚è½½å­åº”ç”¨ã€‚\n\nå…·ä½“åœ°è¯´ï¼Œæ‚¨éœ€è¦æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/test\")\nasync def test():\n    return \"Hello, world!\"\n\n\ndef on_load(server, prev_module):\n    # mount if fastapi_mcdr is ready\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n    if fastapi_mcdr is not None and fastapi_mcdr.is_ready():\n        mount_app(server)\n\n    # register event listener\n    server.register_event_listener(\n        fastapi_mcdr.COLLECT_EVENT,\n        mount_app\n    )\n\n\ndef on_unload(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # unmount app\n    fastapi_mcdr.unmount(id_)\n\n\ndef mount_app(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # mount app\n    fastapi_mcdr.mount(id_, app)\n```\n\nè®¿é—® <http://localhost:8080/docs> å³å¯æŸ¥çœ‹ API æ–‡æ¡£ï¼Œå„æ’ä»¶çš„å­åº”ç”¨æ–‡æ¡£åˆ™éœ€è¦è®¿é—® <http://localhost:8080/plugin_id/docs>ã€‚\n\n## æŠ€æœ¯ç»†èŠ‚\n\n### åŠ è½½\n\nç†è®ºä¸Šæ¥è¯´ï¼Œå¯¹å¤–æä¾› HTTP API åº”å½“æ˜¯ä¸€ç§å¯é€‰åŠŸèƒ½ï¼Œè¿™ä¾¿æ˜¯éœ€è¦æ£€æŸ¥ FastAPI çŠ¶æ€å¹¶åŒæ—¶æ³¨å†Œ COLLECT äº‹ä»¶ç›‘å¬å™¨çš„åŸå› ã€‚ä¸‹å›¾å±•ç¤ºäº† FastAPI æ’ä»¶å’Œè‡ªå®šä¹‰æ’ä»¶å…ˆååŠ è½½çš„æµç¨‹å›¾ï¼š\n\nå…ˆåŠ è½½ FastAPIï¼Œå†åŠ è½½è‡ªå®šä¹‰æ’ä»¶ï¼š\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI åŠ è½½\n    Note right of FastAPI: FastAPI åˆ†å‘ COLLECT äº‹ä»¶\n\n    Note left of Test: Test åŠ è½½\n\n    Test ->> FastAPI: å·²åŠ è½½ï¼Ÿ\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: æŒ‚è½½å­åº”ç”¨\n\n    Note left of Test: Test æ³¨å†Œ COLLECT äº‹ä»¶\n```\n\nå…ˆåŠ è½½è‡ªå®šä¹‰æ’ä»¶ï¼Œå†åŠ è½½ FastAPIï¼š\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note left of Test: Test åŠ è½½\n\n    Test ->> FastAPI: å·²åŠ è½½ï¼Ÿ\n    FastAPI ->> Test: No!\n\n    Note left of Test: Test æ³¨å†Œ COLLECT äº‹ä»¶\n\n    Note right of FastAPI: FastAPI åŠ è½½\n\n    FastAPI ->> Test: åˆ†å‘ COLLECT äº‹ä»¶\n    Test ->> FastAPI: æŒ‚è½½å­åº”ç”¨\n```\n\né€šè¿‡è¿™ä¸ªè®¾è®¡ï¼Œå³å¯å®ç°æ’ä»¶çš„è½¯ä¾èµ–ï¼Œä¸”æ— éœ€è€ƒè™‘æ’ä»¶åŠ è½½é¡ºåºçš„é—®é¢˜ã€‚ä¸‹å›¾å±•ç¤ºäº†ä»»æ„æ’ä»¶é‡è½½çš„æƒ…å†µï¼š\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI é‡è½½\n\n    FastAPI ->> Test: åˆ†å‘ COLLECT äº‹ä»¶\n    Test ->> FastAPI: æŒ‚è½½å­åº”ç”¨\n\n    Note left of Test: Test é‡è½½\n\n    Test ->> FastAPI: å·²åŠ è½½ï¼Ÿ\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: æŒ‚è½½å­åº”ç”¨\n\n    Note left of Test: Test æ³¨å†Œ COLLECT äº‹ä»¶\n```\n\n## æ ‡å‡†\n\n### COLLECT äº‹ä»¶\n\näº‹ä»¶åï¼š`fastapi_mcdr.collect`\n\nè¯¥äº‹ä»¶çš„ `PluginEvent` å®ä¾‹ä¹Ÿä¼šä»¥ `COLLECT_EVENT` åå…¬å¼€ã€‚\n\n### å…¬å¼€å‡½æ•°\n\n#### is_ready\n\næ’ä»¶å‡†å¤‡å¥½æ¥å—æŒ‚è½½çš„çŠ¶æ€ï¼Œå¦‚å¼ºè¡ŒæŒ‚è½½åˆ™ä¼šæŠ›å‡ºä¸€ä¸ª `RuntimeError`ã€‚\n\n#### mount\n\nå‚æ•°ï¼š\n\n- `plugin_id`ï¼šæ’ä»¶ idã€‚\n- `app`ï¼šFastAPI åº”ç”¨ã€‚\n\nå­åº”ç”¨ä¼šæŒ‚è½½åœ¨ `/<plugin_id>` è·¯å¾„ä¸‹ï¼Œæ–‡æ¡£å¯ä»¥é€šè¿‡è®¿é—® `/<plugin_id>/docs` æŸ¥çœ‹ã€‚\n\nå‚é˜…ï¼š[å­åº”ç”¨ - æŒ‚è½½](https://fastapi.tiangolo.com/zh/advanced/sub-applications/)\n\n#### unmount\n\nå‚æ•°ï¼š\n\n- `plugin_id`ï¼šæ’ä»¶ idã€‚\n\nå¸è½½æŒ‡å®šæ’ä»¶çš„å­åº”ç”¨ã€‚\n"
    },
    "introduction_urls": {
      "en_us": "https://raw.githubusercontent.com/AnzhiZhang/MCDReforgedPlugins/master/src/fastapi_mcdr/readme.md",
      "zh_cn": "https://raw.githubusercontent.com/AnzhiZhang/MCDReforgedPlugins/master/src/fastapi_mcdr/readme_cn.md"
    }
  },
  "release": {
    "schema_version": 8,
    "id": "fastapi_mcdr",
    "latest_version": "2.0.0",
    "latest_version_index": 0,
    "releases": [
      {
        "url": "https://github.com/AnzhiZhang/MCDReforgedPlugins/releases/tag/fastapi_mcdr-v2.0.0",
        "name": "fastapi_mcdr: v2.0.0",
        "tag_name": "fastapi_mcdr-v2.0.0",
        "created_at": "2024-09-14T16:09:50Z",
        "description": "## [2.0.0](https://github.com/AnzhiZhang/MCDReforgedPlugins/compare/fastapi_mcdr-v1.0.0...fastapi_mcdr-v2.0.0) (2024-09-14)\n\n\n### âš  BREAKING CHANGES\n\n* **fastapi_mcdr:** api names are changed\n\n### Features\n\n* **fastapi_mcdr:** âœ¨ fastapi sub application (resolve [#232](https://github.com/AnzhiZhang/MCDReforgedPlugins/issues/232)) ([72b6f58](https://github.com/AnzhiZhang/MCDReforgedPlugins/commit/72b6f5875e54034894ed0c24562f06fa905c56d8))\n\n\n### Bug Fixes\n\n* **fastapi_mcdr:** ğŸ”‡ remove logs ([c0ddd93](https://github.com/AnzhiZhang/MCDReforgedPlugins/commit/c0ddd932bef421d38d68afe9f1b70ff4e95be9c8))",
        "prerelease": false,
        "asset": {
          "id": 192623788,
          "name": "FastAPIMCDR-v2.0.0.mcdr",
          "size": 1897,
          "download_count": 204,
          "created_at": "2024-09-14T16:12:12Z",
          "browser_download_url": "https://github.com/AnzhiZhang/MCDReforgedPlugins/releases/download/fastapi_mcdr-v2.0.0/FastAPIMCDR-v2.0.0.mcdr",
          "hash_md5": "67f1891f87452def6d168aabcd124d12",
          "hash_sha256": "458d0ab1c3b4c9ce2e0dfd8b81e08480970ae70e8464c2553f9d863ebb843764"
        },
        "meta": {
          "schema_version": 4,
          "id": "fastapi_mcdr",
          "name": "FastAPI MCDR",
          "version": "2.0.0",
          "link": "https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr",
          "authors": [
            "Andy Zhang"
          ],
          "dependencies": {},
          "requirements": [
            "fastapi",
            "uvicorn"
          ],
          "description": {
            "en_us": "Provides HTTP API.",
            "zh_cn": "æä¾› HTTP APIã€‚"
          }
        }
      },
      {
        "url": "https://github.com/AnzhiZhang/MCDReforgedPlugins/releases/tag/fastapi_mcdr-v1.0.0",
        "name": "fastapi_mcdr: v1.0.0",
        "tag_name": "fastapi_mcdr-v1.0.0",
        "created_at": "2023-12-21T16:37:50Z",
        "description": "## 1.0.0 (2023-12-21)\n\n\n### Features\n\n* **fastapi_mcdr:** ğŸ‰ create fastapi_mcdr ([84247a7](https://github.com/AnzhiZhang/MCDReforgedPlugins/commit/84247a77315a248bc6489e15083352eb4559b68e))",
        "prerelease": false,
        "asset": {
          "id": 141837233,
          "name": "FastAPIMCDR-v1.0.0.mcdr",
          "size": 2344,
          "download_count": 96,
          "created_at": "2023-12-21T16:38:12Z",
          "browser_download_url": "https://github.com/AnzhiZhang/MCDReforgedPlugins/releases/download/fastapi_mcdr-v1.0.0/FastAPIMCDR-v1.0.0.mcdr",
          "hash_md5": "bd33e16eb661704fff7f43e17d9dbff3",
          "hash_sha256": "5bda7446df976ba0992d89a789ce900eed8ec792b23c8b580569696a587bb3d3"
        },
        "meta": {
          "schema_version": 4,
          "id": "fastapi_mcdr",
          "name": "FastAPI MCDR",
          "version": "1.0.0",
          "link": "https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/fastapi_mcdr",
          "authors": [
            "Andy Zhang"
          ],
          "dependencies": {},
          "requirements": [
            "fastapi",
            "uvicorn"
          ],
          "description": {
            "en_us": "Provides HTTP API.",
            "zh_cn": "æä¾› HTTP APIã€‚"
          }
        }
      }
    ]
  },
  "repository": {
    "url": "https://github.com/AnzhiZhang/MCDReforgedPlugins",
    "name": "MCDReforgedPlugins",
    "full_name": "AnzhiZhang/MCDReforgedPlugins",
    "html_url": "https://github.com/AnzhiZhang/MCDReforgedPlugins",
    "description": "MCDReforged Plugins",
    "archived": false,
    "stargazers_count": 99,
    "watchers_count": 99,
    "forks_count": 51,
    "readme": "# FastAPI\n\n[ç®€ä½“ä¸­æ–‡](https://github.com/AnzhiZhang/MCDReforgedPlugins/tree/master/src/fastapi_mcdr/readme_cn.md)\n\n> Provides HTTP API\n> \n> Allows plugins to provide a unified interface by mounting [sub-application](https://fastapi.tiangolo.com/advanced/sub-applications/).\n\n## Quick Start\n\nIn general, there are two things you need to do in your plugin:\n\n1. Check FastAPI's status when loading. If it's ready, directly mount the sub-application.\n2. Register a listener for the COLLECT event to  mount the sub-application when it becomes ready.\n\nSpecifically, you need to add the following code:\n\n```python\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/test\")\nasync def test():\n    return \"Hello, world!\"\n\n\ndef on_load(server, prev_module):\n    # mount if fastapi_mcdr is ready\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n    if fastapi_mcdr is not None and fastapi_mcdr.is_ready():\n        mount_app(server)\n\n    # register event listener\n    server.register_event_listener(\n        fastapi_mcdr.COLLECT_EVENT,\n        mount_app\n    )\n\n\ndef on_unload(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # unmount app\n    fastapi_mcdr.unmount(id_)\n\n\ndef mount_app(server):\n    # save plugin id and fastapi_mcdr instance\n    id_ = server.get_self_metadata().id\n    fastapi_mcdr = server.get_plugin_instance('fastapi_mcdr')\n\n    # mount app\n    fastapi_mcdr.mount(id_, app)\n```\n\nVisit <http://localhost:8080/docs> to view the API documentation, and visit <http://localhost:8080/plugin_id/docs> to view the sub application documentation for each plugin.\n\n## Technical Details\n\n### Loading\n\nIn theory, providing an HTTP API externally should be an optional feature. That's why checking FastAPI's status and registering an COLLECT event listener are necessary. The following diagram illustrates the process of loading FastAPI and custom plugins:\n\nLoad FastAPI first, then load custom plugins:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Load\n    Note right of FastAPI: FastAPI Dispatch COLLECT Event\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Mount Sub-Application\n\n    Note left of Test: Test Register COLLECT Event\n```\n\nLoad custom plugins first, then load FastAPI:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note left of Test: Test Load\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: No!\n\n    Note left of Test: Test Register COLLECT Event\n\n    Note right of FastAPI: FastAPI Load\n\n    FastAPI ->> Test: Dispatch COLLECT Event\n    Test ->> FastAPI: Mount Sub-Application\n```\n\nWith this design, you can achieve soft plugin dependency without worrying about the order of plugin loading. The following diagram shows the scenario of any plugin being reloaded:\n\n```mermaid\nsequenceDiagram\n    participant FastAPI\n    participant Test\n\n    Note right of FastAPI: FastAPI Reload\n\n    FastAPI ->> Test: Dispatch COLLECT Event\n    Test ->> FastAPI: Mount Sub-Application\n\n    Note left of Test: Test Reload\n\n    Test ->> FastAPI: Loaded?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: is_ready?\n    FastAPI ->> Test: Yes!\n    Test ->> FastAPI: Mount Sub-Application\n\n    Note left of Test: Test Register COLLECT Event\n```\n\n## Standards\n\n### COLLECT Event\n\nEvent name: `fastapi_mcdr.collect`\n\nAn instance of `PluginEvent` for this event is also exposed as `COLLECT_EVENT`.\n\n### Public Functions\n\n#### is_ready\n\nThe plugin's status if ready to mount. If forcefully mounted, it will raise a `RuntimeError`.\n\n#### mount\n\nArguments:\n\n- `plugin_id`: Plugin ID.\n- `app`: FastAPI App.\n\nThe sub-application will be mounted at the `/<plugin_id>` path, and the documentation can be viewed by visiting `/<plugin_id>/docs`.\n\nSee: [Sub Applications - Mounts](https://fastapi.tiangolo.com/advanced/sub-applications/)\n\n#### unmount\n\nArguments:\n\n- `plugin_id`: Plugin ID.\n\nUnmount the sub-application of the specified plugin.\n",
    "readme_url": "https://raw.githubusercontent.com/AnzhiZhang/MCDReforgedPlugins/master/src/fastapi_mcdr/readme.md",
    "license": {
      "key": "gpl-3.0",
      "name": "GNU General Public License v3.0",
      "spdx_id": "GPL-3.0",
      "url": "https://api.github.com/licenses/gpl-3.0"
    }
  }
}