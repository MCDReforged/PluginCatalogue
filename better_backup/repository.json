{
  "url": "https://github.com/z0z0r4/better_backup",
  "name": "better_backup",
  "full_name": "z0z0r4/better_backup",
  "html_url": "https://github.com/z0z0r4/better_backup",
  "description": "Less disk usage, never duplicate files.",
  "archived": true,
  "stargazers_count": 13,
  "watchers_count": 13,
  "forks_count": 2,
  "readme": "**中文** | [English](https://github.com/z0z0r4/better_backup/tree/master/README_en.md)\n\n# Better_Backup\n\n> [!WARNING]\n> **Better Backup 计划停更，建议使用 [PrimeBackup](https://github.com/TISUnion/PrimeBackup)** ~~马上高三无力维护~~  \n> ~~**Better Backup 目前正处于试验阶段。强烈建议您不要在生产环境使用，并做好重要数据备份。**~~  \n> 在报告问题前，请留意您正使用的是否为最新版本。\n\n一个高效备份回档、更少磁盘占用、避免重复文件的 MCDR 插件。\n\n![image](https://github.com/z0z0r4/better_backup/assets/45303195/1f586ea7-a7f2-456d-bc19-09eade53f798)\n\n> [!IMPORTANT]\n> v2.0.0 起使用 SQlite 不兼容以前版本的 JSON 备份数据  \n> v2.1.0 起使用 xxHash 不兼容以前版本的哈希数据  \n> **请使用[迁移脚本](https://github.com/z0z0r4/better_backup/blob/main/scripts/migrate.py)，或在旧版本提前清除 `better_backup` 文件夹内所有数据**\n\n## 特性\n\n- 避免重复文件，比 [QuickBackupM](https://github.com/TISUnion/QuickBackupM) 节省 20% ~ 90% 备份空间  \n  对于大存档和读写性能低下的硬盘，速度显著优于 [QuickBackupM](https://github.com/TISUnion/QuickBackupM) ([基准测试](https://github.com/z0z0r4/better_backup/issues/5))\n- 内置定时备份\n- 支持 zstd 压缩，额外节省 50% 以上备份空间，且不影响回档速度\n- xxHash 计算哈希值，节省 20% ~ 70% 运算时间\n- 支持自动删除过旧备份，保留指定数量的备份\n- 轻松导出完整备份\n\n---\n\n备份的存档将会存放至 `better_backup` 文件夹中，文件目录格式如下：\n```python\nmcd_root/\n    better_backup/\n        cache/ # 备份文件\n            00/\n                ...\n            0a/\n            0b/\n            ...\n\n        export_backup/ # 导出\n            ...\n\n        overwrite/ # 留底\n            ...\n\n        storage.db # 数据库\n```\n\n## 命令格式说明\n\n`!!bb` 显示帮助信息\n\n`!!bb make [<message>]` 创建备份。`<message>` 为可选存档注释\n\n`!!bb restore [<uuid|index>]` 回档为槽位 `<uuid|index>` 的存档\n\n`!!bb remove [<uuid|index>]` 删除槽位 `<uuid|index>` 的存档\n\n`!!bb confirm` 在执行 `!!bb restore [<uuid|index>]` 后使用，再次确认是否进行回档\n\n`!!bb abort` 在任何时候键入此指令可中断回档\n\n`!!bb list [<page>]` 显示分页存档信息，默认为第一页\n\n`!!bb reload` 重新加载配置文件\n\n`!!bb reset` 重置存档数据\n\n`!!bb export [<uuid|index>] [plain|tar|tar_gz|tar_xz] [compress_level]` 导出备份数据\n\n`!!bb lock [<uuid|index>]` 锁定或解锁备份点。锁定的备份点将在自动删除时被忽略，不计入数量限制中\n\n当 `<uuid|index>` 未设置或为 1 时为最新备份点的 uuid\n\n如 `2` 为由新到旧的第二个备份点，此处不考虑 `page`，需自行计算\n\n`!!bb timer` 显示定时器状态\n\n`!!bb timer enable` 启动备份定时器\n\n`!!bb timer disable` 关闭备份定时器\n\n`!!bb timer set_interval §6<minutes>` 设置备份定时器时间间隔，单位分钟\n\n`!!bb timer reset` 重置备份定时器\n\n## 配置文件选项说明\n\n配置文件为 `config/better_backup.json`。它会在第一次运行时自动生成，默认值如下（不支持注释）：\n\n```json5\n{\n    \"size_display\": true, // 是否显示文件大小信息\n    \"turn_off_auto_save\": true, // 是否关闭自动保存\n    \"ignored_files\": [ // 不备份的文件\n        \"session.lock\"\n    ],\n    \"ignored_folders\": [], // 不备份的目录\n    \"ignored_extensions\": [ // 不备份的扩展名\n        \".lock\"\n    ],\n    \"world_names\": [ // 要备份的世界列表\n        \"world\"\n    ],\n    \"save_command\": {\n        \"save-off\": \"save-off\",\n        \"save-all flush\": \"save-all flush\",\n        \"save-on\": \"save-on\"\n    },\n    \"saved_output\": [\n        \"Saved the game\",\n        \"Saved the world\"\n    ],\n    \"backup_data_path\": \"./better_backup\", // 备份路径\n    \"server_path\": \"./server\", // 服务端位置\n    \"overwrite_backup_folder\": \"overwrite\", // 覆盖备份文件夹名称\n    \"backup_compress_level\": 3, // 备份 zst 压缩等级 (1~22)，为 0 时禁用\n    \"export_backup_folder\": \"./export_backup\", // 备份导出路径\n    \"export_backup_format\": \"tar_gz\", // 备份导出格式 (plain, tar, tar_gz, tar_xz)\n    \"export_backup_compress_level\": 1, // 备份压缩等级\n    \"auto_remove\": true, // 自动删除旧备份\n    \"backup_count_limit\": 20, // 备份留存数量\n    \"minimum_permission_level\": { // MCDR 指令权限等级\n        \"make\": 1, // 创建\n        \"restore\": 2, // 回档\n        \"remove\": 2, // 删除\n        \"confirm\": 1, // 确认\n        \"abort\": 1, // 终止\n        \"reload\": 2, // 重载\n        \"list\": 0, // 查看列表\n        \"reset\": 2, // 重置\n        \"timer\": 2, // 操作定时器\n        \"export\": 4 // 导出\n    },\n    \"timer_enabled\": true, // 是否启用定时备份\n    \"timer_interval\": 5.0 // 定时间隔\n}\n```\n\n## Todo list\n\n已基本完成，目前主要进行 Bug 修复\n\n以下 TODO 优先级从高到低\n\n- [x] 支持锁定指定备份不被自动删除\n- [x] 文件链接处理\n- [x] SQlite 支持\n- [x] 导出支持 `.tar.zst`\n- [x] xxHash\n- [ ] 忽略文件/目录时支持通配符\n- [ ] 备份和还原文件 stat\n\n## Won't do\n\n- [ ] ~~云备份，包括各家对象存储和 WebDav，不考虑无接口官方 API 网盘~~\n- [ ] ~~多盘备份，将备份同步保存到多个路径~~\n- [ ] ~~支持 Diff 备份数据库~~\n- [ ] ~~支持修改备份点注释~~\n",
  "readme_url": "https://raw.githubusercontent.com/z0z0r4/better_backup/master/README.md",
  "license": {
    "key": "mit",
    "name": "MIT License",
    "spdx_id": "MIT",
    "url": "https://api.github.com/licenses/mit"
  }
}