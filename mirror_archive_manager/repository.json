{
  "url": "https://github.com/Aimerny/MCDRPlugins",
  "name": "MCDRPlugins",
  "full_name": "Aimerny/MCDRPlugins",
  "html_url": "https://github.com/Aimerny/MCDRPlugins",
  "description": "Aimerny's MCDR plugins repository",
  "archived": false,
  "stargazers_count": 7,
  "watchers_count": 7,
  "forks_count": 1,
  "readme": "# MirrorArchiveManager\n\n一个基于Prime_Backup插件的支持管理多个镜像服务器的插件,支持存档同步,启停控制\n\n# 功能\n> [!IMPORTANT]\n> 该插件不会帮助你自动配置镜像服,请确保你已经配好了可以正常游玩的镜像服再使用本插件.\n\n**MirrorArchiveManager**插件借助[Prime Backup](https://github.com/TISUnion/PrimeBackup/tree/master)插件(以下简称\"pb\")强大的存档备份及回档机制,实现了以下功能\n1. 支持将主服选择pb的存档直接回档到镜像服\n2. 主服支持配置多个镜像服\n3. 主服可以通过指令直接控制镜像服的启停\n\n## 帮助指令\n\n```\n========== Mirror Archive Manager ==========\n!!mam start <server_name> -- 启动镜像服 <server_name>\n!!mam stop <server_name> -- 停止镜像服 <server_name>\n!!mam sync <server_name> <id> -- 将 prime_backup 中的编号#<id>的存档同步到<server_name>\n================ by Aimerny ================\n```\n\n## 依赖\n\n| python依赖项 | 版本       |\n| --------- | -------- |\n| requests  | ^2.31.0  |\n| fastapi   | ^0.111.1 |\n\n| mcdr依赖项      | 版本      |\n| ------------ | ------- |\n| mcdreforged  | ^2.12.x |\n| prime_backup | ^1.7.4  |\n\n# 使用说明\n在MirrorArchiveManager插件(以下简称`mam`)的视角里,服务器有两个角色,分别为`main`和`mirror`.\n如果你需要将`main`服务器的pb备份同步到`mirror`服务器,则需要进行一些小小的配置\n\n## 使用前配置\n\n### main服务器配置(未展示的配置无需配置)\n```json5\n{\n    // 需要设置为true\n    \"main\": true,\n    // 镜像服配置,可配置多个\n    \"mirrors\": [\n        {\n            // 镜像服务器名\n            \"name\": \"mirror\",\n            // 镜像服务器地址\n            \"host\": \"127.0.0.1\",\n            // 镜像服务器配置的端口(如下配置中设置了30076)\n            \"port\": 30076\n        }\n    ],\n    // 指令的MCDR权限等级\n    \"perms\": {\n        \"start\": 3,\n        \"stop\": 3,\n        \"sync\": 3\n    }\n}\n```\n\n### mirror服务器配置(未展示的配置无需配置)\n```json5\n{\n    // 需要设置为false\n    \"main\": false,\n    // 主服的相对路径或绝对路径\n    \"main_path\": \"../main\",\n    // 控制端口\n    \"port\": 30076\n}\n```\n### 启动主服+镜像服\n启动后你会在主服看到如下日志:\n```\n[MCDR] [03:01:41] [TaskExecutor/INFO] [mirror_archive_manager]: MAM running with main role!\n[MCDR] [03:01:41] [TaskExecutor/INFO] [mirror_archive_manager]: MirrorArchiveManager initialization completed!\n```\n在镜像服会看到如下日志:\n```\n[MCDR] [03:07:04] [TaskExecutor/INFO] [mirror_archive_manager]: MAM running with mirror role!\n[MCDR] [03:07:04] [TaskExecutor/INFO] [mirror_archive_manager]: mirror http server started...\n[MCDR] [03:07:04] [TaskExecutor/INFO] [mirror_archive_manager]: mirror process...\n[MCDR] [03:07:04] [TaskExecutor/INFO] [mirror_archive_manager]: MirrorArchiveManager initialization completed!\n```\n此时插件便加载成功了.\n\n## 启停镜像服\n> [!IMPORTANT]\n> 虽然该插件具有启停镜像服功能,但是要求镜像服处于MCDR进程启动的状态.换而言之,只有通过mam停止的镜像服才能再通过mam启动\n### 停止\n`!!mam stop <server_name>`: `server_name`非必填,如果没填会用第一个已配置的镜像服\n### 启动\n`!!mam start <server_name>`: `server_name`非必填,如果没填会用第一个已配置的镜像服\n\n## 指定备份存档同步到镜像服\n`!!mam sync <id> <server_name>`\n1. `server_name`非必填,如果没填会用第一个已配置的镜像服\n2. `id`为pb备份id,**必填**\n\n# 配置详解\n| 配置             | 说明                              | 示例                              |\n| -------------- | ------------------------------- | ------------------------------- |\n| main           | 是否是主服角色,必填                      | true                            |\n| mirrors        | 镜像服配置,主服必填                      | []                              |\n| mirrors[].name | 主服操作镜像时的名称,必填且唯一                | mirror                          |\n| mirrors[].host | 主服连接镜像时的地址,必填                   | 127.0.0.1                       |\n| mirrors[].port | 主服连接镜像时访问端口,必填                  | 30076                           |\n| main_path      | 镜像服相对主服的文件夹的相对路径或者主服的绝对路径,镜像服必填 | ../main 或者 /Users/aim/mcdr/main |\n| port           | 镜像服被主服访问的端口,镜像服必填               | 30076                           |\n| perms          | 指令操作权限等级,使用MCDR的权限等级,主服必填       | 3                               |\n",
  "readme_url": "https://raw.githubusercontent.com/Aimerny/MCDRPlugins/main/src/mirror_archive_manager/README.md",
  "license": {
    "key": "gpl-3.0",
    "name": "GNU General Public License v3.0",
    "spdx_id": "GPL-3.0",
    "url": "https://api.github.com/licenses/gpl-3.0"
  }
}