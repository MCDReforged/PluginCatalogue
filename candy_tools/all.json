{
  "meta": {
    "schema_version": 4,
    "id": "candy_tools",
    "name": "Candy Tools",
    "version": "1.0.0",
    "link": "https://github.com/Passion-Never-Dissipate/candy_tools",
    "authors": [
      "FRUITS_CANDY"
    ],
    "dependencies": {
      "mcdreforged": ">=2.7.0"
    },
    "requirements": [
      "mcdreforged>=2.7.0"
    ],
    "description": {
      "en_us": "The prerequisite API for the MCDR plugin of FRUITS_CANDY",
      "zh_cn": "FRUITS_CANDY的MCDR插件的前置api"
    }
  },
  "plugin": {
    "schema_version": 1,
    "id": "candy_tools",
    "authors": [
      "FRUITS_CANDY"
    ],
    "repository": "https://github.com/Passion-Never-Dissipate/candy_tools",
    "branch": "main",
    "related_path": ".",
    "labels": [
      "api"
    ],
    "introduction": {
      "zh_cn": "# Candy Tools\n\n## 概述\n\n本插件主要作为前置api用于FRUITS_CANDY开发的MCDR插件，如果你有兴趣使用可以下载源码查看完整功能。\n\n**⚠️ 重要警告：所有 API 函数都不能在任务执行者 (TaskExecutor) 线程中调用，否则会抛出 `RuntimeError` 异常！**\n\n**注意：部分功能需要安装 Carpet mod 才能使用**\n\n## 功能特性\n\n- ✅ 执行任意命令并根据正则表达式匹配结果\n- ✅ 监听服务器输出中的特定消息\n- ✅ 支持返回完整字符串或正则匹配对象\n- ✅ 获取在线玩家列表（支持筛选假人）\n- ✅ 检测服务端上是否加载了 Carpet mod\n- ✅ 获取指定坐标范围内所有玩家的 NBT 属性\n- ✅ 获取指定坐标范围内所有玩家列表\n- ✅ 线程安全，支持插件热重载\n\n## 安装\n\n### 前置要求\n\n- MCDReforged >= 2.7.0\n- Minecraft 服务器（支持 Fabric 服务端）（可选）\n\n### 安装步骤\n\n将插件放入 MCDR 的 `plugins` 目录 或使用指令 `!!MCDR plugin install candy_tools` 来安装插件\n\n## API 使用指南\n\n### 基本导入\n\n```python\nimport candy_tools\n# 或者只导入需要的函数\nfrom candy_tools import execute_and_wait, listen_and_wait\n```\n\n### 核心功能\n\n#### 1. 执行命令并等待结果\n\n##### 1.1 返回完整字符串\n\n```python\n# 获取玩家列表\nresult = candy_tools.execute_and_wait_str(\n    command=\"list\",\n    pattern=r\"There are \\d+ of a max of \\d+ players online:.*\",\n    timeout=5.0\n)\n\nif result:\n    print(f\"服务器返回: {result}\")\nelse:\n    print(\"命令执行超时\")\n```\n\n##### 1.2 返回正则匹配对象（提取分组）\n\n```python\n# 获取世界时间并提取时间值\nmatch = candy_tools.execute_and_wait_match(\n    command=\"time query daytime\",\n    pattern=r\"The time is (\\d+)\",\n    timeout=3.0\n)\n\nif match:\n    world_time = match.group(1)  # 获取匹配的分组\n    print(f\"世界时间: {world_time}\")\n```\n\n##### 1.3 使用命名分组（更清晰）\n\n```python\nmatch = candy_tools.execute_and_wait_match(\n    command=\"list\",\n    pattern=r\"There are (?P<current>\\d+) of a max of (?P<max>\\d+) players online:(?P<players>.*)\",\n    timeout=5.0\n)\n\nif match:\n    current_players = match.group('current')  # 当前在线玩家数\n    max_players = match.group('max')         # 最大玩家数\n    player_list = match.group('players')     # 玩家名字列表\n    print(f\"在线: {current_players}/{max_players}\")\n    print(f\"玩家列表: {player_list}\")\n```\n\n#### 2. 监听服务器消息\n\n##### 2.1 监听特定事件\n\n```python\n# 监听玩家加入消息\nmessage = candy_tools.listen_and_wait_str(\n    pattern=r\"Player (\\w+) joined the game\",\n    timeout=30.0\n)\n\nif message:\n    print(f\"有玩家加入: {message}\")\n\n# 监听服务器启动完成\nmatch = candy_tools.listen_and_wait_match(\n    pattern=r\"Done \\((\\d+\\.\\d+)s\\)! For help, type \\\"help\\\"\",\n    timeout=60.0\n)\n\nif match:\n    startup_time = match.group(1)\n    print(f\"服务器启动完成，耗时: {startup_time}秒\")\n```\n\n### 3. 其他功能（部分需要 Carpet mod）\n\n#### 3.1 检测 Carpet 模组\n\n```python\n# 检测服务器是否加载了 Carpet 模组\nhas_carpet = candy_tools.query_carpet()\nprint(f\"服务器是否安装 Carpet 模组: {has_carpet}\")\n\n```\n\n#### 3.2 获取在线玩家列表（需要 Carpet mod）\n\n```python\n# 获取所有在线玩家（包括真人和假人）\nplayers = candy_tools.get_online_players(timeout=5.0)\n\nif players is None:\n    print(\"查询超时\")\nelif len(players) == 0:\n    print(\"没有在线玩家\")\nelse:\n    print(f\"在线玩家 ({len(players)}): {players}\")\n\n# 仅获取假人玩家\nfake_players = candy_tools.get_online_fake_players(timeout=5.0)\n\nif fake_players is None:\n    print(\"查询超时\")\nelif len(fake_players) == 0:\n    print(\"没有在线假人\")\nelse:\n    print(f\"在线假人 ({len(fake_players)}): {fake_players}\")\n```\n\n#### 3.3 获取区域内的玩家信息（需要 Carpet mod）\n\n##### 3.3.1 定义区域字典\n\n```python\n# 区域定义示例\nregions = {\n    # 原版维度使用简写名称\n    'overworld': [\n        {'x1': -100, 'x2': 100, 'y1': 0, 'y2': 255, 'z1': -100, 'z2': 100},\n        {'x1': 200, 'x2': 300, 'z1': 200, 'z2': 300}  # y坐标可省略，表示全高度\n    ],\n    'the_nether': [\n        {'x1': -50, 'x2': 50, 'y1': 0, 'y2': 127, 'z1': -50, 'z2': 50}\n    ],\n    # 非原版维度使用完整名称\n    'twilightforest:twilight_forest': [\n        {'x1': -50, 'x2': 50}  # 可只定义x，z，y坐标中的一个\n    ]\n}\n```\n\n##### 3.3.2 获取玩家 NBT 属性\n\n```python\n# 获取区域内玩家的UUID\nplayers = candy_tools.get_players_nbt_in_regions(\n    region_dict=regions,\n    nbt_attribute='uuid',  # 可以是 'uuid', 'health', 'gamemode', 'name' 等\n    timeout=10.0\n)\n\nif players is None:\n    print(\"查询超时\")\nelif players == {}:  # 空字典\n    print(\"区域内没有玩家\")\nelse:\n    for player_name, uuid in players.items():\n        print(f\"{player_name}: {uuid}\")\n```\n\n##### 3.3.3 仅获取玩家名称\n\n```python\n# 使用辅助函数获取区域内玩家名称列表\nplayers = candy_tools.get_online_players_in_regions(\n    region_dict=regions,\n    timeout=10.0\n)\n\nif players is None:\n    print(\"查询超时\")\nelif len(players) == 0:\n    print(\"区域内没有玩家\")\nelse:\n    print(f\"区域内玩家 ({len(players)}): {players}\")\n```\n\n##### 3.3.4 获取其他 NBT 属性\n\n```python\n# 获取玩家游戏模式\nplayers_gamemode = candy_tools.get_players_nbt_in_regions(\n    region_dict=regions,\n    nbt_attribute='gamemode',  # 0=生存, 1=创造, 2=冒险, 3=旁观\n    timeout=10.0\n)\n\nif players_gamemode:\n    for player_name, gamemode in players_gamemode.items():\n        print(f\"{player_name}: 游戏模式={gamemode}\")\n\n# 获取玩家生命值\nplayers_health = candy_tools.get_players_nbt_in_regions(\n    region_dict=regions,\n    nbt_attribute='health',\n    timeout=10.0\n)\n\nif players_health:\n    for player_name, health in players_health.items():\n        print(f\"{player_name}: 生命值={health}\")\n```\n\n## 错误处理\n\n### 主线程调用异常\n\n```python\ntry:\n    # 错误：在任务执行者线程中调用\n    result = candy_tools.execute_and_wait_str(\"list\", r\"players online\")\nexcept RuntimeError as e:\n    print(f\"错误: {e}\")\n    # 错误信息会是: \"Cannot invoke execute_and_wait on the task executor thread\"\n```\n\n### 正确的线程管理\n\n```python\n# 使用MCDR的 @new_thread 装饰器\n@new_thread(\"query-thread\")\ndef safe_query():\n    result = candy_tools.execute_and_wait_str(\"list\", r\"players online\")\n    return result\n\n# 使用 Python threading模块\nimport threading\ndef safe_query_2():\n    def query():\n        result = candy_tools.execute_and_wait_str(\"list\", r\"players online\")\n        # 处理结果...\n\n    threading.Thread(target=query, daemon=True).start()\n```\n\n### 超时处理\n\n所有 API 函数都有 `timeout` 参数，超时会返回 `None`：\n\n```python\nresult = candy_tools.execute_and_wait_str(\"list\", r\"players online\", timeout=2.0)\nif result is None:\n    print(\"命令执行超时\")\n```\n\n### 正则表达式错误\n\n如果提供的正则表达式无效，会记录错误并返回 `None`：\n\n```python\n# 错误的正则表达式\nresult = candy_tools.execute_and_wait_str(\"list\", r\"invalid[regex\", timeout=2.0)\n# result 为 None，控制台会输出错误日志\n```\n\n## 故障排除\n\n### 常见问题\n\n1. **API 返回 None**\n   - 检查命令是否正确执行\n   - 使用的API可能依赖carpet mod\n   - 检查正则表达式是否匹配命令输出\n   - 增加超时时间\n\n2. **插件加载失败**\n   - 检查 MCDReforged 版本是否 >= 2.7.0\n   - 检查插件文件是否完整\n   - 查看 MCDR 日志中的错误信息\n\n## 贡献与反馈\n\n- 项目地址：https://github.com/Passion-Never-Dissipate/candy_tools\n- 问题反馈：在 GitHub Issues 中提交问题\n- 功能建议：欢迎提交 Pull Request\n\n---\n\n\n"
    },
    "introduction_urls": {
      "zh_cn": "https://raw.githubusercontent.com/Passion-Never-Dissipate/candy_tools/main/README.md"
    }
  },
  "release": {
    "schema_version": 8,
    "id": "candy_tools",
    "latest_version": "1.0.0",
    "latest_version_index": 0,
    "releases": [
      {
        "url": "https://github.com/Passion-Never-Dissipate/candy_tools/releases/tag/1.0.0",
        "name": "Candy_Tools-v1.0.0",
        "tag_name": "1.0.0",
        "created_at": "2026-02-06T14:25:55Z",
        "description": "不会有人真用这个插件吧？",
        "prerelease": false,
        "asset": {
          "id": 351718337,
          "name": "Candy_Tools-v1.0.0.mcdr",
          "size": 20315,
          "download_count": 8,
          "created_at": "2026-02-06T14:28:48Z",
          "browser_download_url": "https://github.com/Passion-Never-Dissipate/candy_tools/releases/download/1.0.0/Candy_Tools-v1.0.0.mcdr",
          "hash_md5": "9d4179c74fe5339d6807f97d7352efbe",
          "hash_sha256": "ffb8035075c12143d0deed48826e929485f31b41812f82c35010701f1ae9b207"
        },
        "meta": {
          "schema_version": 4,
          "id": "candy_tools",
          "name": "Candy Tools",
          "version": "1.0.0",
          "link": "https://github.com/Passion-Never-Dissipate/candy_tools",
          "authors": [
            "FRUITS_CANDY"
          ],
          "dependencies": {
            "mcdreforged": ">=2.7.0"
          },
          "requirements": [
            "mcdreforged>=2.7.0"
          ],
          "description": {
            "en_us": "The prerequisite API for the MCDR plugin of FRUITS_CANDY",
            "zh_cn": "FRUITS_CANDY的MCDR插件的前置api"
          }
        }
      }
    ]
  },
  "repository": {
    "url": "https://github.com/Passion-Never-Dissipate/candy_tools",
    "name": "candy_tools",
    "full_name": "Passion-Never-Dissipate/candy_tools",
    "html_url": "https://github.com/Passion-Never-Dissipate/candy_tools",
    "description": "FRUITS_CANDY的MCDR插件的前置api",
    "archived": false,
    "stargazers_count": 0,
    "watchers_count": 0,
    "forks_count": 0,
    "readme": "# Candy Tools\n\n## 概述\n\n本插件主要作为前置api用于FRUITS_CANDY开发的MCDR插件，如果你有兴趣使用可以下载源码查看完整功能。\n\n**⚠️ 重要警告：所有 API 函数都不能在任务执行者 (TaskExecutor) 线程中调用，否则会抛出 `RuntimeError` 异常！**\n\n**注意：部分功能需要安装 Carpet mod 才能使用**\n\n## 功能特性\n\n- ✅ 执行任意命令并根据正则表达式匹配结果\n- ✅ 监听服务器输出中的特定消息\n- ✅ 支持返回完整字符串或正则匹配对象\n- ✅ 获取在线玩家列表（支持筛选假人）\n- ✅ 检测服务端上是否加载了 Carpet mod\n- ✅ 获取指定坐标范围内所有玩家的 NBT 属性\n- ✅ 获取指定坐标范围内所有玩家列表\n- ✅ 线程安全，支持插件热重载\n\n## 安装\n\n### 前置要求\n\n- MCDReforged >= 2.7.0\n- Minecraft 服务器（支持 Fabric 服务端）（可选）\n\n### 安装步骤\n\n将插件放入 MCDR 的 `plugins` 目录 或使用指令 `!!MCDR plugin install candy_tools` 来安装插件\n\n## API 使用指南\n\n### 基本导入\n\n```python\nimport candy_tools\n# 或者只导入需要的函数\nfrom candy_tools import execute_and_wait, listen_and_wait\n```\n\n### 核心功能\n\n#### 1. 执行命令并等待结果\n\n##### 1.1 返回完整字符串\n\n```python\n# 获取玩家列表\nresult = candy_tools.execute_and_wait_str(\n    command=\"list\",\n    pattern=r\"There are \\d+ of a max of \\d+ players online:.*\",\n    timeout=5.0\n)\n\nif result:\n    print(f\"服务器返回: {result}\")\nelse:\n    print(\"命令执行超时\")\n```\n\n##### 1.2 返回正则匹配对象（提取分组）\n\n```python\n# 获取世界时间并提取时间值\nmatch = candy_tools.execute_and_wait_match(\n    command=\"time query daytime\",\n    pattern=r\"The time is (\\d+)\",\n    timeout=3.0\n)\n\nif match:\n    world_time = match.group(1)  # 获取匹配的分组\n    print(f\"世界时间: {world_time}\")\n```\n\n##### 1.3 使用命名分组（更清晰）\n\n```python\nmatch = candy_tools.execute_and_wait_match(\n    command=\"list\",\n    pattern=r\"There are (?P<current>\\d+) of a max of (?P<max>\\d+) players online:(?P<players>.*)\",\n    timeout=5.0\n)\n\nif match:\n    current_players = match.group('current')  # 当前在线玩家数\n    max_players = match.group('max')         # 最大玩家数\n    player_list = match.group('players')     # 玩家名字列表\n    print(f\"在线: {current_players}/{max_players}\")\n    print(f\"玩家列表: {player_list}\")\n```\n\n#### 2. 监听服务器消息\n\n##### 2.1 监听特定事件\n\n```python\n# 监听玩家加入消息\nmessage = candy_tools.listen_and_wait_str(\n    pattern=r\"Player (\\w+) joined the game\",\n    timeout=30.0\n)\n\nif message:\n    print(f\"有玩家加入: {message}\")\n\n# 监听服务器启动完成\nmatch = candy_tools.listen_and_wait_match(\n    pattern=r\"Done \\((\\d+\\.\\d+)s\\)! For help, type \\\"help\\\"\",\n    timeout=60.0\n)\n\nif match:\n    startup_time = match.group(1)\n    print(f\"服务器启动完成，耗时: {startup_time}秒\")\n```\n\n### 3. 其他功能（部分需要 Carpet mod）\n\n#### 3.1 检测 Carpet 模组\n\n```python\n# 检测服务器是否加载了 Carpet 模组\nhas_carpet = candy_tools.query_carpet()\nprint(f\"服务器是否安装 Carpet 模组: {has_carpet}\")\n\n```\n\n#### 3.2 获取在线玩家列表（需要 Carpet mod）\n\n```python\n# 获取所有在线玩家（包括真人和假人）\nplayers = candy_tools.get_online_players(timeout=5.0)\n\nif players is None:\n    print(\"查询超时\")\nelif len(players) == 0:\n    print(\"没有在线玩家\")\nelse:\n    print(f\"在线玩家 ({len(players)}): {players}\")\n\n# 仅获取假人玩家\nfake_players = candy_tools.get_online_fake_players(timeout=5.0)\n\nif fake_players is None:\n    print(\"查询超时\")\nelif len(fake_players) == 0:\n    print(\"没有在线假人\")\nelse:\n    print(f\"在线假人 ({len(fake_players)}): {fake_players}\")\n```\n\n#### 3.3 获取区域内的玩家信息（需要 Carpet mod）\n\n##### 3.3.1 定义区域字典\n\n```python\n# 区域定义示例\nregions = {\n    # 原版维度使用简写名称\n    'overworld': [\n        {'x1': -100, 'x2': 100, 'y1': 0, 'y2': 255, 'z1': -100, 'z2': 100},\n        {'x1': 200, 'x2': 300, 'z1': 200, 'z2': 300}  # y坐标可省略，表示全高度\n    ],\n    'the_nether': [\n        {'x1': -50, 'x2': 50, 'y1': 0, 'y2': 127, 'z1': -50, 'z2': 50}\n    ],\n    # 非原版维度使用完整名称\n    'twilightforest:twilight_forest': [\n        {'x1': -50, 'x2': 50}  # 可只定义x，z，y坐标中的一个\n    ]\n}\n```\n\n##### 3.3.2 获取玩家 NBT 属性\n\n```python\n# 获取区域内玩家的UUID\nplayers = candy_tools.get_players_nbt_in_regions(\n    region_dict=regions,\n    nbt_attribute='uuid',  # 可以是 'uuid', 'health', 'gamemode', 'name' 等\n    timeout=10.0\n)\n\nif players is None:\n    print(\"查询超时\")\nelif players == {}:  # 空字典\n    print(\"区域内没有玩家\")\nelse:\n    for player_name, uuid in players.items():\n        print(f\"{player_name}: {uuid}\")\n```\n\n##### 3.3.3 仅获取玩家名称\n\n```python\n# 使用辅助函数获取区域内玩家名称列表\nplayers = candy_tools.get_online_players_in_regions(\n    region_dict=regions,\n    timeout=10.0\n)\n\nif players is None:\n    print(\"查询超时\")\nelif len(players) == 0:\n    print(\"区域内没有玩家\")\nelse:\n    print(f\"区域内玩家 ({len(players)}): {players}\")\n```\n\n##### 3.3.4 获取其他 NBT 属性\n\n```python\n# 获取玩家游戏模式\nplayers_gamemode = candy_tools.get_players_nbt_in_regions(\n    region_dict=regions,\n    nbt_attribute='gamemode',  # 0=生存, 1=创造, 2=冒险, 3=旁观\n    timeout=10.0\n)\n\nif players_gamemode:\n    for player_name, gamemode in players_gamemode.items():\n        print(f\"{player_name}: 游戏模式={gamemode}\")\n\n# 获取玩家生命值\nplayers_health = candy_tools.get_players_nbt_in_regions(\n    region_dict=regions,\n    nbt_attribute='health',\n    timeout=10.0\n)\n\nif players_health:\n    for player_name, health in players_health.items():\n        print(f\"{player_name}: 生命值={health}\")\n```\n\n## 错误处理\n\n### 主线程调用异常\n\n```python\ntry:\n    # 错误：在任务执行者线程中调用\n    result = candy_tools.execute_and_wait_str(\"list\", r\"players online\")\nexcept RuntimeError as e:\n    print(f\"错误: {e}\")\n    # 错误信息会是: \"Cannot invoke execute_and_wait on the task executor thread\"\n```\n\n### 正确的线程管理\n\n```python\n# 使用MCDR的 @new_thread 装饰器\n@new_thread(\"query-thread\")\ndef safe_query():\n    result = candy_tools.execute_and_wait_str(\"list\", r\"players online\")\n    return result\n\n# 使用 Python threading模块\nimport threading\ndef safe_query_2():\n    def query():\n        result = candy_tools.execute_and_wait_str(\"list\", r\"players online\")\n        # 处理结果...\n\n    threading.Thread(target=query, daemon=True).start()\n```\n\n### 超时处理\n\n所有 API 函数都有 `timeout` 参数，超时会返回 `None`：\n\n```python\nresult = candy_tools.execute_and_wait_str(\"list\", r\"players online\", timeout=2.0)\nif result is None:\n    print(\"命令执行超时\")\n```\n\n### 正则表达式错误\n\n如果提供的正则表达式无效，会记录错误并返回 `None`：\n\n```python\n# 错误的正则表达式\nresult = candy_tools.execute_and_wait_str(\"list\", r\"invalid[regex\", timeout=2.0)\n# result 为 None，控制台会输出错误日志\n```\n\n## 故障排除\n\n### 常见问题\n\n1. **API 返回 None**\n   - 检查命令是否正确执行\n   - 使用的API可能依赖carpet mod\n   - 检查正则表达式是否匹配命令输出\n   - 增加超时时间\n\n2. **插件加载失败**\n   - 检查 MCDReforged 版本是否 >= 2.7.0\n   - 检查插件文件是否完整\n   - 查看 MCDR 日志中的错误信息\n\n## 贡献与反馈\n\n- 项目地址：https://github.com/Passion-Never-Dissipate/candy_tools\n- 问题反馈：在 GitHub Issues 中提交问题\n- 功能建议：欢迎提交 Pull Request\n\n---\n\n\n",
    "readme_url": "https://raw.githubusercontent.com/Passion-Never-Dissipate/candy_tools/main/README.md",
    "license": {
      "key": "gpl-3.0",
      "name": "GNU General Public License v3.0",
      "spdx_id": "GPL-3.0",
      "url": "https://api.github.com/licenses/gpl-3.0"
    }
  }
}